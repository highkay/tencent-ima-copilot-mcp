# IMA Copilot MCP 服务器配置文件
# 复制此文件为 .env 并填入实际的配置值

# ===== 必需配置 =====

# IMA 平台相关的请求头（必需）
# 从浏览器开发者工具的 Network 标签中，找到 /cgi-bin/assistant/qa 请求
# 复制 Request Headers 中的 X-Ima-Cookie 字段值
# 格式: PLATFORM=H5; CLIENT-TYPE=256053; WEB-VERSION=xxx; IMA-GUID=xxx; IMA-TOKEN=xxx; IMA-REFRESH-TOKEN=xxx; UID-TYPE=2; TOKEN-TYPE=14
IMA_X_IMA_COOKIE="PLATFORM=H5; CLIENT-TYPE=256053; WEB-VERSION=999.999.999; IMA-GUID=guid-883ea7caa3c7b03e3188beb60200000f018409; IMA-Q36=883ea7caa3c7b03e3188beb60200000f018409; IMA-IUA=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0; IMA-UID=0019cdbbf48060e9; IMA-TOKEN=pPu0y5Ktq4qv9aSEI+wIrEMz/icOT/f9nVVQx+B1HYOWOOY03hWy/PGYTdsWpgLORVK0qo8ZZbTxO14+L5dNJ9TRU/nrpy0VOSGi7pixZpvQE9iLQPY7KpMSs63LHvcCTn1bt04ywSm6P1+vFFyrI0vHSlud+XMhcQUbBpW3f60QJA==; IMA-REFRESH-TOKEN=oTnsm4CdhNP4T6fBah7zv1kkSZEidkGygqc0Z7DR4bli+X9tWXN0O5GkvetPKHH6PdZB98DN6Nk25xwV7KMm/k0RpEKKr1dh3n7XQB2wFCvXmVDcOcvx4uNddL057q74JFHC0Do6mMO4/ifgEbr61UFaK4yEfTpoIw9ENHus/BaE5J0IdAZVNtXDSRWlH5VF1rpSJNNB; UID-TYPE=2; TOKEN-TYPE=14"

# IMA 业务密钥（必需）
# 从浏览器开发者工具的 Network 标签中，找到 /cgi-bin/assistant/qa 请求
# 复制 Request Headers 中的 X-Ima-Bkn 字段值
IMA_X_IMA_BKN="1842948893"

# 知识库ID（必需）
# 从浏览器开发者工具的 Network 标签中，找到 /cgi-bin/session_logic/init_session 请求
# 查看 Request Payload 中的 knowledgeBaseInfoWithFolder.knowledge_base_id 字段值
IMA_KNOWLEDGE_BASE_ID="7305806844290061"

# ===== 可选配置 =====

# 完整的 Cookie 字符串（可选，用于增强认证）
# 从浏览器开发者工具的 Network 标签中，找到任意请求
# 复制 Request Headers 中的完整 Cookie 字段值
# 注意：现在只需要 X-Ima-Cookie 和 X-Ima-Bkn 就可以正常运行，此项为可选
# IMA_COOKIES="RK=VG/JI4ujMX; ptcz=12aca7ecc7499cd96a9357c4b046bd8e749dcc3a58da0e404f3711e20d7c6416; pac_uid=0_SXXdArDX8tyWm; uin=o0617502063; skey=@rbO8x2wtb"

# 设备唯一标识符（可选，如果不提供会自动生成）
# IMA_USKEY="your_uskey_here"

# 客户端ID（可选，如果不提供会自动生成 UUID）
# IMA_CLIENT_ID="your_client_id_here"

# ===== 服务器配置 =====

# MCP 服务器监听地址
IMA_MCP_HOST=127.0.0.1

# MCP 服务器监听端口
IMA_MCP_PORT=8081

# 调试模式 (true/false)
IMA_MCP_DEBUG=false

# 日志级别 (DEBUG, INFO, WARNING, ERROR)
IMA_MCP_LOG_LEVEL=INFO

# ===== IMA API 配置 =====

# 请求超时时间（秒）
IMA_REQUEST_TIMEOUT=30

# 重试次数
IMA_RETRY_COUNT=3

# 代理设置 (可选)
# 格式: http://proxy.example.com:8080
# IMA_PROXY=http://proxy.example.com:8080

# ===== 配置获取指南 =====

# 1. 在浏览器中打开 IMA Copilot Web 版: https://ima.qq.com
# 2. 按 F12 打开开发者工具
# 3. 切换到 Network (网络) 标签页
# 4. 在筛选框中输入 "assistant" 或 "session"

# 获取知识库 ID:
# - 在 IMA 中选择你要使用的知识库
# - 找到 init_session 请求
# - 查看 Payload 中的 knowledgeBaseInfoWithFolder.knowledge_base_id

# 获取认证头信息:
# - 在 IMA 中发送一条消息
# - 找到 /cgi-bin/assistant/qa 请求
# - 查看 Request Headers:
#   - X-Ima-Cookie → IMA_X_IMA_COOKIE（必需）
#   - X-Ima-Bkn → IMA_X_IMA_BKN（必需）
#   - Cookie → IMA_COOKIES（可选）

# 注意：
# - 必须包含 IMA-REFRESH-TOKEN 才能使用 token 自动刷新功能
# - 定期重新获取认证信息以确保服务可用性

# ===== 启动方式 =====

# 方式一：使用启动脚本（推荐）
# Windows: start.bat
# 跨平台: python run.py

# 方式二：使用 fastmcp 命令
# fastmcp run ima_server_simple.py:mcp --transport http --host 127.0.0.1 --port 8081

# 方式三：仅验证配置
# python run.py --check

# 使用 MCP Inspector 连接:
# npx @modelcontextprotocol/inspector
# 然后连接到: http://127.0.0.1:8081/mcp
